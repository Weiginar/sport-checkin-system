import{i as f}from"./index-Bn9PLWWT.js";import{a as E}from"./index-B9m2kLEc.js";import{_ as S,j as A,B as L,k as I,o as N,c as O,b as o,w as t,E as T,r as c,i as p,g as d,a as _}from"./index-3HccLX9U.js";const U={class:"statistics-page"},D={__name:"Statistics",setup(G){const m=p(30),v=p(null),y=p(null),g=p(null);let n=null,l=null,i=null;const b=()=>{n=f(v.value),l=f(y.value),i=f(g.value)},R=a=>{const e=a.map(s=>s.date),r=a.map(s=>s.count);n.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:e,boundaryGap:!1},yAxis:{type:"value",minInterval:1},dataZoom:[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}],series:[{name:"打卡人数",type:"line",smooth:!0,areaStyle:{opacity:.15},data:r}],grid:{left:50,right:30,top:20,bottom:70}})},k=a=>{l.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",top:"center"},series:[{name:"运动类型",type:"pie",radius:["40%","70%"],center:["60%","50%"],label:{formatter:`{b}
{d}%`},data:a.map(e=>({name:e.name,value:e.count}))}]})},z=a=>{const e=a.map(s=>s.date),r=a.map(s=>s.newUsers);i.setOption({tooltip:{trigger:"axis"},xAxis:{type:"category",data:e,axisLabel:{rotate:30}},yAxis:{type:"value",minInterval:1},series:[{name:"新增用户",type:"bar",data:r,itemStyle:{borderRadius:[4,4,0,0]}}],grid:{left:50,right:20,top:20,bottom:60}})},w=async()=>{try{const a=await E({days:m.value}),{dailyCheckins:e,sportDistribution:r,userGrowth:s}=a.data||{};R(e||[]),k(r||[]),z(s||[])}catch{T.error("加载统计数据失败")}},B=()=>{w()},x=()=>{n==null||n.resize(),l==null||l.resize(),i==null||i.resize()};return A(async()=>{await L(),b(),w(),window.addEventListener("resize",x)}),I(()=>{window.removeEventListener("resize",x),n==null||n.dispose(),l==null||l.dispose(),i==null||i.dispose()}),(a,e)=>{const r=c("el-radio-button"),s=c("el-radio-group"),u=c("el-card"),h=c("el-col"),C=c("el-row");return N(),O("div",U,[o(u,{shadow:"never",class:"filter-card"},{default:t(()=>[o(s,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=V=>m.value=V),onChange:B},{default:t(()=>[o(r,{value:7},{default:t(()=>[...e[1]||(e[1]=[d("近7天",-1)])]),_:1}),o(r,{value:30},{default:t(()=>[...e[2]||(e[2]=[d("近30天",-1)])]),_:1}),o(r,{value:90},{default:t(()=>[...e[3]||(e[3]=[d("近90天",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(u,{shadow:"never",class:"chart-card"},{header:t(()=>[...e[4]||(e[4]=[d("每日打卡人数趋势",-1)])]),default:t(()=>[_("div",{ref_key:"lineChartRef",ref:v,class:"chart-container chart-large"},null,512)]),_:1}),o(C,{gutter:16},{default:t(()=>[o(h,{span:12},{default:t(()=>[o(u,{shadow:"never",class:"chart-card"},{header:t(()=>[...e[5]||(e[5]=[d("运动类型分布",-1)])]),default:t(()=>[_("div",{ref_key:"pieChartRef",ref:y,class:"chart-container"},null,512)]),_:1})]),_:1}),o(h,{span:12},{default:t(()=>[o(u,{shadow:"never",class:"chart-card"},{header:t(()=>[...e[6]||(e[6]=[d("用户增长趋势",-1)])]),default:t(()=>[_("div",{ref_key:"barChartRef",ref:g,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1})])}}},Z=S(D,[["__scopeId","data-v-309860d2"]]);export{Z as default};
