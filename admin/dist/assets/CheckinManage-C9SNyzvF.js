import{_ as E,j as R,o as g,c as k,b as a,w as l,E as _,r as o,i as f,h as I,q as U,z as Y,F as L,A as j,v as z,g as D,s as F,a as O,y as $}from"./index-3HccLX9U.js";import{c as q,h as A,i as P}from"./index-B9m2kLEc.js";const G={class:"checkin-manage"},H={class:"pagination-wrap"},J={__name:"CheckinManage",setup(K){const m=f(!1),b=f([]),r=I({userId:"",sportTypeId:"",dateRange:null}),d=I({page:1,pageSize:20,total:0}),v=f([]),C=async()=>{var i;try{const e=await q({pageNum:1,pageSize:100}),p=((i=e.data)==null?void 0:i.records)||e.data||[];v.value=p.map(s=>({label:s.name,value:s.id}))}catch(e){console.error("加载运动类型失败",e)}},c=async()=>{var i,e;m.value=!0;try{const p={pageNum:d.page,pageSize:d.pageSize,userId:r.userId||void 0,sportTypeId:r.sportTypeId||void 0,startDate:((i=r.dateRange)==null?void 0:i[0])||void 0,endDate:((e=r.dateRange)==null?void 0:e[1])||void 0},s=await A(p),u=s.data||s||{};b.value=u.records||[],d.total=u.total||0}catch{_.error("加载打卡记录失败")}finally{m.value=!1}},h=()=>{d.page=1,c()},S=async i=>{try{await $.confirm(`确定要删除该打卡记录 (ID: ${i.id}) 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(i.id),_.success("删除成功"),c()}catch(e){e!=="cancel"&&_.error("删除失败")}};return R(()=>{C(),c()}),(i,e)=>{const p=o("el-input"),s=o("el-form-item"),u=o("el-option"),V=o("el-select"),x=o("el-date-picker"),w=o("el-button"),T=o("el-form"),y=o("el-card"),n=o("el-table-column"),M=o("el-table"),B=o("el-pagination"),N=U("loading");return g(),k("div",G,[a(y,{shadow:"never",class:"filter-card"},{default:l(()=>[a(T,{inline:!0,onSubmit:Y(h,["prevent"])},{default:l(()=>[a(s,{label:"用户ID"},{default:l(()=>[a(p,{modelValue:r.userId,"onUpdate:modelValue":e[0]||(e[0]=t=>r.userId=t),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"运动类型"},{default:l(()=>[a(V,{modelValue:r.sportTypeId,"onUpdate:modelValue":e[1]||(e[1]=t=>r.sportTypeId=t),placeholder:"全部类型",clearable:""},{default:l(()=>[(g(!0),k(L,null,j(v.value,t=>(g(),z(u,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"日期范围"},{default:l(()=>[a(x,{modelValue:r.dateRange,"onUpdate:modelValue":e[2]||(e[2]=t=>r.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(s,null,{default:l(()=>[a(w,{type:"primary",onClick:h},{default:l(()=>[...e[5]||(e[5]=[D("搜索",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(y,{shadow:"never",class:"table-card"},{default:l(()=>[F((g(),z(M,{data:b.value,border:"",stripe:""},{default:l(()=>[a(n,{prop:"id",label:"ID",width:"70"}),a(n,{prop:"username",label:"用户名",width:"110"}),a(n,{prop:"nickname",label:"昵称",width:"110"}),a(n,{prop:"sportTypeName",label:"运动类型",width:"100"}),a(n,{prop:"checkinDate",label:"打卡日期",width:"120"}),a(n,{prop:"duration",label:"时长(分钟)",width:"100",align:"center"}),a(n,{prop:"distance",label:"距离(km)",width:"100",align:"center"}),a(n,{prop:"calories",label:"卡路里",width:"90",align:"center"}),a(n,{prop:"pointsEarned",label:"获得积分",width:"90",align:"center"}),a(n,{prop:"remark",label:"备注","min-width":"140","show-overflow-tooltip":""}),a(n,{label:"操作",width:"90",fixed:"right",align:"center"},{default:l(({row:t})=>[a(w,{type:"danger",link:"",size:"small",onClick:Q=>S(t)},{default:l(()=>[...e[6]||(e[6]=[D(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,m.value]]),O("div",H,[a(B,{"current-page":d.page,"onUpdate:currentPage":e[3]||(e[3]=t=>d.page=t),"page-size":d.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>d.pageSize=t),"page-sizes":[10,20,50,100],total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])]),_:1})])}}},Z=E(J,[["__scopeId","data-v-995bb810"]]);export{Z as default};
